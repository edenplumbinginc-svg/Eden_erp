[Mode: Execution]

Step: Run a smoke test that proves the new execution logging is truthful, idempotent, and respects DRY_RUN vs LIVE.

Why it matters: Confirms the architect’s fixes in the real system: no pre-success logging, no duplicate actions, and LIVE successes stay immutable.

Inputs needed:

App base URL and admin JWT

One checklist item you can complete in <60 minutes (to trigger the ⚡ badge policy)

Policy ID for auto-badge-speed-demons (you’ll fetch it)

Command (exact actions):

Get policy IDs

# list policies
curl -s -H "Authorization: Bearer ADMIN_JWT" https://APP_URL/api/admin/decisions/policies


Locate the object with name: "auto-badge-speed-demons" and copy its id → POLICY_ID.

Enable policy in DRY_RUN (simulation only)

# ensure enabled + dry_run = true
curl -s -X PATCH -H "Authorization: Bearer ADMIN_JWT" \
  -H "Content-Type: application/json" \
  -d '{"enabled":true,"dry_run":true}' \
  https://APP_URL/api/admin/decisions/policies/POLICY_ID


Trigger a fast completion

In the UI, complete any checklist item within <60 minutes of its creation (or create-now → complete-now).

Run the policy immediately

curl -s -X POST -H "Authorization: Bearer ADMIN_JWT" \
  https://APP_URL/api/admin/decisions/policies/POLICY_ID/run


Verify DRY_RUN execution (no side effects, success=false)

curl -s -H "Authorization: Bearer ADMIN_JWT" \
  "https://APP_URL/api/admin/decisions/executions?policy_id=POLICY_ID&limit=5"


Check the latest row: dry_run=true, success=false, and no duplicate task created.

Flip to LIVE and re-run

# dry_run -> false (LIVE)
curl -s -X PATCH -H "Authorization: Bearer ADMIN_JWT" \
  -H "Content-Type: application/json" \
  -d '{"dry_run":false}' \
  https://APP_URL/api/admin/decisions/policies/POLICY_ID

# run again
curl -s -X POST -H "Authorization: Bearer ADMIN_JWT" \
  https://APP_URL/api/admin/decisions/policies/POLICY_ID/run


Verify LIVE success (now it logs only after action succeeds)

curl -s -H "Authorization: Bearer ADMIN_JWT" \
  "https://APP_URL/api/admin/decisions/executions?policy_id=POLICY_ID&limit=5"


Expected on the newest row:

dry_run=false

success=true

error_text=null

Badge should exist on the task in the UI.

Idempotency check (no duplicates)

# run again immediately with the same conditions
curl -s -X POST -H "Authorization: Bearer ADMIN_JWT" \
  https://APP_URL/api/admin/decisions/policies/POLICY_ID/run


Re-check executions (same GET as step 7).
Expected: no new success row for the same action; the engine skips due to action_hash uniqueness.

Success check:

You share:

One DRY_RUN execution JSON (shows dry_run=true, success=false).

One LIVE execution JSON (shows dry_run=false, success=true).

A second LIVE run produces no duplicate success entry for the same action.

In UI /admin/decisions → Execution History: rows reflect Mode and Result correctly; no pre-success rows.

Next: wait for user.